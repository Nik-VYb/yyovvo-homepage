<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>yyovvo ‚Äî designed for emotion</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />

    <style>
      /* ROOT */
      html,
      body {
        margin: 0;
        padding: 0;
        background: #000;
        overflow: hidden;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", sans-serif;
        color: #f9fafb;
      }

      #yyovvo-container {
        position: fixed;
        inset: 0;
        background: #000;
        overflow: hidden;
      }

      /* MAIN VIDEO LAYER */
      #scene {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        background: #000;
        transition: opacity 400ms ease;
        filter: brightness(1.05) contrast(1.08) saturate(1.08);
        z-index: 1;
      }

      /* LENS GLOW OVERLAY (STYLE A) */
      #lens-overlay {
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 2;
        background:
          radial-gradient(circle at 15% 0%, rgba(56, 189, 248, 0.28), transparent 55%),
          radial-gradient(circle at 85% 10%, rgba(236, 72, 153, 0.3), transparent 55%),
          radial-gradient(circle at 50% 100%, rgba(34, 197, 94, 0.18), transparent 60%),
          radial-gradient(circle at 50% 50%, rgba(15, 23, 42, 0.8), transparent 80%);
        mix-blend-mode: screen;
        opacity: 0.9;
      }

      /* Faux film grain */
      #lens-overlay::after {
        content: "";
        position: absolute;
        inset: 0;
        opacity: 0.14;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 160 160' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.2' numOctaves='3' stitchTiles='noStitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.6'/%3E%3C/svg%3E");
        mix-blend-mode: soft-light;
      }

      /* TEXT OVERLAYS */
      .overlay-text {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 18px;
        text-align: center;
        font-size: 1.1rem;
        line-height: 1.6;
        color: #f9fafb;
        text-shadow:
          0 0 18px rgba(0, 0, 0, 0.9),
          0 0 30px rgba(0, 0, 0, 0.9);
        opacity: 0;
        z-index: 3;
        transition: opacity 320ms ease;
      }

      .overlay-text.show {
        opacity: 1;
      }

      /* OUTRO (yyovvo + tagline) */
      .overlay-outro {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 6px;
        text-align: center;
        color: #f9fafb;
        text-shadow:
          0 0 18px rgba(0, 0, 0, 0.95),
          0 0 30px rgba(0, 0, 0, 0.95);
        opacity: 0;
        z-index: 4;
        transition: opacity 400ms ease;
      }

      .overlay-outro.show {
        opacity: 1;
      }

      .outro-title {
        font-size: 2.2rem;
        letter-spacing: 0.18em;
        text-transform: lowercase;
      }

      .outro-sub {
        font-size: 0.95rem;
        opacity: 0.9;
      }

      .heart {
        display: inline-block;
        animation: pulse 1.2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.8;
        }
        50% {
          transform: scale(1.16);
          opacity: 1;
        }
      }

      /* FINAL END SCREEN */
      .end-screen {
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at center, #020617, #000);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 26px 22px 34px;
        opacity: 0;
        pointer-events: none;
        z-index: 5;
        transition: opacity 500ms ease;
      }

      .end-screen.show {
        opacity: 1;
        pointer-events: auto;
      }

      .end-pulse {
        width: 170px;
        height: 170px;
        border-radius: 999px;
        background: radial-gradient(
          circle at center,
          rgba(236, 72, 153, 0.45),
          transparent 70%
        );
        opacity: 0.75;
        filter: blur(14px);
        animation: endPulseGlow 2.4s ease-in-out infinite;
        pointer-events: none;
      }

      @keyframes endPulseGlow {
        0%,
        100% {
          transform: scale(0.9);
          opacity: 0.7;
        }
        50% {
          transform: scale(1.08);
          opacity: 0.95;
        }
      }

      .end-text-block {
        position: relative;
        margin-top: -44px;
        text-align: center;
        max-width: 330px;
      }

      .end-line1 {
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 4px;
      }

      .end-line2 {
        font-size: 0.95rem;
        opacity: 0.86;
      }

      .end-buttons {
        margin-top: 26px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: 100%;
        max-width: 360px;
      }

      .end-btn {
        border-radius: 999px;
        border: 1px solid rgba(156, 163, 175, 0.55);
        padding: 10px 18px;
        font-size: 0.9rem;
        font-weight: 500;
        text-align: center;
        text-decoration: none;
        color: #f9fafb;
        background: rgba(15, 23, 42, 0.9);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        cursor: pointer;
        transition:
          transform 150ms ease,
          box-shadow 150ms ease,
          background 150ms ease,
          border-color 150ms ease,
          opacity 150ms ease;
      }

      .end-btn.primary {
        background: radial-gradient(
          circle at top left,
          rgba(236, 72, 153, 0.95),
          rgba(59, 130, 246, 0.95)
        );
        border-color: transparent;
        box-shadow: 0 0 32px rgba(236, 72, 153, 0.5);
      }

      .end-btn.ghost {
        background: rgba(15, 23, 42, 0.92);
      }

      .end-btn.outline {
        background: transparent;
        border-color: rgba(148, 163, 184, 0.8);
        opacity: 0.9;
      }

      .end-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 40px rgba(15, 23, 42, 0.9);
      }

      .end-btn.primary:hover {
        box-shadow: 0 0 40px rgba(236, 72, 153, 0.8);
      }

      .end-btn span.label-sub {
        font-size: 0.8rem;
        opacity: 0.9;
      }

      .end-footer {
        margin-top: 22px;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 6px;
        opacity: 0;
        animation: footerIn 800ms ease forwards 900ms;
      }

      .end-heart {
        font-size: 0.9rem;
      }

      .end-counter {
        opacity: 0.85;
        animation: counterRoll 900ms ease-out forwards;
        transform: translateY(8px);
      }

      @keyframes footerIn {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes counterRoll {
        0% {
          transform: translateY(8px);
          opacity: 0;
        }
        60% {
          transform: translateY(-2px);
          opacity: 1;
        }
        100% {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @media (min-width: 768px) {
        .end-text-block {
          max-width: 420px;
        }
        .end-line1 {
          font-size: 1.25rem;
        }
        .end-line2 {
          font-size: 1rem;
        }
        .end-buttons {
          max-width: 420px;
        }
      }

      /* MOBILE OUTRO TUNING */
      @media (max-width: 640px) {
        .overlay-outro {
          padding: 0 1.5rem;
        }
        .overlay-outro .outro-title {
          font-size: 24px;
          letter-spacing: 0.16em;
          line-height: 1.2;
        }
        .overlay-outro .outro-sub {
          font-size: 12px;
          margin-top: 6px;
        }
        .overlay-outro .heart {
          font-size: 13px;
        }
      }
    </style>
  </head>

  <body>
    <div id="yyovvo-container">
      <!-- MAIN CINEMATIC VIDEO (mood intro ‚Üí user video ‚Üí outro) -->
      <video id="scene" playsinline autoplay muted></video>

      <!-- LENS GLOW OVERLAY (A: lens / light leaks) -->
      <div id="lens-overlay"></div>

      <!-- INTRO TEXT OVERLAY -->
      <div id="overlay-intro" class="overlay-text"></div>

      <!-- MAIN MESSAGE TEXT OVERLAY (for text-mode yyovvos) -->
      <div id="overlay-main-text" class="overlay-text"></div>

      <!-- OUTRO OVERLAY (yyovvo + tagline) -->
      <div id="overlay-outro" class="overlay-outro">
        <div class="outro-title">yyovvo</div>
        <div class="outro-sub">
          designed for emotion <span class="heart">‚ô°</span>
        </div>
      </div>

      <!-- OUTRO JINGLE -->
      <audio id="yyo-jingle" src="/audio/yyovvo-jingle.mp3"></audio>

      <!-- FINAL POST-YYOVVO END SCREEN -->
      <div id="end-screen" class="end-screen">
        <div class="end-pulse"></div>
        <div class="end-text-block">
          <div class="end-line1">this moment was made for you.</div>
          <div class="end-line2">by someone who really cares about you.</div>
        </div>

        <div class="end-buttons">
          <!-- 1) Reply -->
          <a
            href="https://studio.yyovvo.com/CreateYyovvo"
            target="_blank"
            rel="noopener noreferrer"
            class="end-btn primary"
          >
            reply with your own yyovvo
          </a>

          <!-- 2) Share -->
          <button type="button" id="share-btn" class="end-btn ghost">
            share this moment on tiktok / instagram
          </button>

          <!-- 3) Upgrade -->
          <a
            href="https://studio.yyovvo.com/upgrade"
            target="_blank"
            rel="noopener noreferrer"
            class="end-btn outline"
          >
            unlock all yyovvo features
          </a>
        </div>

        <div class="end-footer">
          <span class="end-heart">‚ù§Ô∏è</span>
          <span class="end-counter" id="yyovvo-counter">
            2,777,777 yyovvos sent this season
          </span>
        </div>
      </div>
    </div>

    <!-- INLINE PLAYER: CINEMA + BASE44 + END SCREEN -->
    <script>
      (async function () {
        console.log("yyovvo cinematic player ‚Äî lens overlay / video-aware");

        const scene = document.getElementById("scene");
        const introEl = document.getElementById("overlay-intro");
        const mainEl = document.getElementById("overlay-main-text");
        const outroEl = document.getElementById("overlay-outro");
        const jingle = document.getElementById("yyo-jingle");
        const endScreen = document.getElementById("end-screen");
        const shareBtn = document.getElementById("share-btn");

        // TIMELINE CONSTANTS (we‚Äôll extend dynamically based on video length)
        const INTRO_START_MS = 3000;
        const INTRO_END_MS = 6000;
        const MAIN_START_MS = 6000;
        const OUTRO_TAIL_MS = 4000; // length of outro snow before end screen

        // 1) DEFAULT moodskin INTRO
        const moodSkinUrl = "/videos/moodskin01.mp4";
        scene.src = moodSkinUrl;
        scene.loop = false;
        scene.muted = true; // keep muted for autoplay
        scene.playsInline = true;

        scene
          .play()
          .catch((err) => {
            console.warn("Autoplay failed, waiting for user gesture.", err);
          });

        // 2) DEFAULT TEXT FALLBACKS
        let introText = "this moment was made for you.";
        let mainText = "someone out there really cares about you.";
        let contentType = "text";
        let contentUrl = "";
        let contentDurationMs = 8000; // default 8 seconds

        // 3) LOAD REAL DATA FROM BASE44
        try {
          const params = new URLSearchParams(window.location.search);
          const id = params.get("id");
          console.log("yyovvo id from URL:", id);

          if (id) {
            const url = `https://moment-cf83ed32.base44.app/api/apps/69023ddd9333e12fcf83ed32/functions/yyovvoGet?id=${encodeURIComponent(
              id
            )}`;

            console.log("Fetching yyovvo from:", url);
            const res = await fetch(url);
            console.log("Response status:", res.status);

            if (res.ok) {
              const raw = await res.json().catch(() => null);
              console.log("Raw yyovvo response:", raw);

              let data = raw;
              if (raw && raw.data && (raw.data.fields || raw.data.record)) {
                data = raw.data.fields || raw.data.record;
              } else if (raw && raw.data) {
                data = raw.data;
              } else if (raw && raw.record) {
                data = raw.record;
              } else if (raw && raw.fields) {
                data = raw.fields;
              }

              console.log("Unwrapped yyovvo data:", data);

              if (data) {
                introText = data.intro_text || data.intro || introText;
                mainText =
                  data.content_text ||
                  data.content ||
                  data.message ||
                  mainText;

                contentType = (data.content_type || "text").toLowerCase();
                contentUrl = data.content_url || "";

                const rawDur = Number(data.content_duration) || 8;
                // If > 60 assume ms, else treat as seconds
                contentDurationMs =
                  rawDur > 60 ? rawDur : rawDur * 1000;

                console.log(
                  "PARSED:",
                  "\n  introText=",
                  introText,
                  "\n  mainText=",
                  mainText,
                  "\n  contentType=",
                  contentType,
                  "\n  contentUrl=",
                  contentUrl,
                  "\n  contentDurationMs=",
                  contentDurationMs
                );
              }
            } else {
              console.warn(
                "yyovvoGet failed:",
                await res.text().catch(() => "")
              );
            }
          } else {
            console.warn("No ?id in URL, using default emotional copy.");
          }
        } catch (err) {
          console.warn("Error loading yyovvo from Base44:", err);
        }

        // 4) INTRO 3‚Äì6s
        setTimeout(() => {
          console.log("SHOW INTRO");
          introEl.textContent = introText;
          introEl.classList.add("show");
        }, INTRO_START_MS);

        setTimeout(() => {
          console.log("HIDE INTRO");
          introEl.classList.remove("show");
        }, INTRO_END_MS);

        // 5) MAIN SEQUENCE (TEXT OR VIDEO)
        const MAIN_END_MS = MAIN_START_MS + contentDurationMs;
        const OUTRO_START_MS = MAIN_END_MS;
        const END_SCREEN_START_MS = OUTRO_START_MS + OUTRO_TAIL_MS;

        console.log(
          "TIMELINE:",
          "\n  MAIN_START_MS=",
          MAIN_START_MS,
          "\n  MAIN_END_MS=",
          MAIN_END_MS,
          "\n  OUTRO_START_MS=",
          OUTRO_START_MS,
          "\n  END_SCREEN_START_MS=",
          END_SCREEN_START_MS
        );

        // MAIN START
        setTimeout(() => {
          console.log("MAIN START ‚Äî contentType:", contentType);

          if (contentType === "video" && contentUrl) {
            console.log("Switching to user video:", contentUrl);
            scene.src = contentUrl;
            scene.loop = false;
            // Still muted at the moment; we unmute shortly after for audio
            scene.muted = true;
            scene.playsInline = true;
            scene
              .play()
              .then(() => {
                // Attempt to unmute ~300ms later (after intro fully gone)
                setTimeout(() => {
                  console.log("Attempting to unmute user video audio.");
                  scene.muted = false;
                }, 300);
              })
              .catch((err) => {
                console.warn(
                  "User video autoplay may need tap on some devices:",
                  err
                );
              });
          } else {
            // TEXT MODE
            console.log("Showing main text:", mainText);
            mainEl.textContent = mainText;
            mainEl.classList.add("show");
          }
        }, MAIN_START_MS);

        // MAIN END (hide text if we were in text mode)
        setTimeout(() => {
          console.log("MAIN END");
          mainEl.classList.remove("show");
        }, MAIN_END_MS);

        // 6) OUTRO: switch back to snow + logo + jingle
        setTimeout(() => {
          console.log("SHOW OUTRO + jingle");

          // Switch to outro snow video
          scene.src = "/videos/outro-snow.mp4";
          scene.loop = true;
          scene.muted = false; // let the ambience + jingle sit on top
          scene
            .play()
            .catch((err) =>
              console.warn("Outro video play issue (safe to ignore):", err)
            );

          // Show outro overlay
          outroEl.classList.add("show");

          // Play jingle
          try {
            jingle.currentTime = 0;
            jingle
              .play()
              .catch((err) =>
                console.warn("Jingle autoplay failed (may need tap):", err)
              );
          } catch (e) {
            console.warn("Jingle error:", e);
          }
        }, OUTRO_START_MS);

        // 7) FINAL END SCREEN
        setTimeout(() => {
          console.log("SHOW END SCREEN");
          try {
            scene.pause();
          } catch (e) {}

          scene.style.opacity = "0";
          introEl.classList.remove("show");
          mainEl.classList.remove("show");
          outroEl.classList.remove("show");
          endScreen.classList.add("show");
        }, END_SCREEN_START_MS);

        // 8) SHARE BUTTON
        if (shareBtn) {
          shareBtn.addEventListener("click", async () => {
            const shareUrl = window.location.href;
            const shareText =
              "Someone made this yyovvo moment just for me. üíå";

            if (navigator.share) {
              try {
                await navigator.share({
                  title: "yyovvo ‚Äî designed for emotion",
                  text: shareText,
                  url: shareUrl,
                });
              } catch (err) {
                console.warn("Native share cancelled/failed:", err);
              }
            } else {
              alert(
                "Share this moment by sending this link:\n\n" + shareUrl
              );
            }
          });
        }
      })();
    </script>
  </body>
</html>
