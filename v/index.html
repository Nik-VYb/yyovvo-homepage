<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>yyovvo ‚Äì cinematic moment</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />

    <!-- Base player styles (mobile outro tuning etc.) -->
    <link rel="stylesheet" href="/player/player.css" />

    <style>
      /* MAIN CONTAINER */
      #yyovvo-container {
        position: relative;
        width: 100%;
        height: 100vh;
        overflow: hidden;
        background: #000;
        font-family: system-ui, -apple-system, BlinkMacSystemFont,
          "SF Pro Text", "Segoe UI", sans-serif;
        color: #f9fafb;
      }

      /* BACKGROUND VIDEO (mood + skin) */
      #scene {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 1;
        transition: opacity 400ms ease;
      }

      /* SELFIE VIDEO (overlaid inside the ‚Äúwindow‚Äù) */
      #user-video {
        position: absolute;
        top: 16%;
        left: 50%;
        transform: translateX(-50%);
        width: 64%;
        height: auto;
        border-radius: 24px;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.9);
        object-fit: cover;
        opacity: 0;
        z-index: 2;
        transition: opacity 300ms ease;
      }

      #user-video.show {
        opacity: 1;
      }

      /* INTRO / MAIN TEXT OVERLAYS */
      .overlay-text {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
        text-align: center;
        font-size: 1.1rem;
        line-height: 1.5;
        color: #f9fafb;
        text-shadow: 0 0 18px rgba(0, 0, 0, 0.9);
        opacity: 0;
        z-index: 3;
        transition: opacity 300ms ease;
      }

      .overlay-text.show {
        opacity: 1;
      }

      /* OUTRO (yyovvo + tagline) */
      .overlay-outro {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 6px;
        text-align: center;
        color: #f9fafb;
        text-shadow: 0 0 22px rgba(0, 0, 0, 0.95);
        opacity: 0;
        z-index: 4;
        transition: opacity 400ms ease;
      }

      .overlay-outro.show {
        opacity: 1;
      }

      .outro-title {
        font-size: 2.1rem;
        letter-spacing: 0.18em;
        text-transform: lowercase;
      }

      .outro-sub {
        font-size: 0.95rem;
        opacity: 0.9;
      }

      .heart {
        display: inline-block;
        animation: pulse 1.2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.8;
        }
        50% {
          transform: scale(1.18);
          opacity: 1;
        }
      }

      /* FINAL END SCREEN (AFTER OUTRO) */
      .end-screen {
        position: absolute;
        inset: 0;
        background: #000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 24px 20px 32px;
        opacity: 0;
        pointer-events: none;
        z-index: 5;
        transition: opacity 500ms ease;
      }

      .end-screen.show {
        opacity: 1;
        pointer-events: auto;
      }

      .end-pulse {
        width: 160px;
        height: 160px;
        border-radius: 999px;
        background: radial-gradient(
          circle at center,
          rgba(236, 72, 153, 0.4),
          transparent 70%
        );
        opacity: 0.7;
        filter: blur(14px);
        animation: endPulseGlow 2.4s ease-in-out infinite;
        pointer-events: none;
      }

      @keyframes endPulseGlow {
        0%,
        100% {
          transform: scale(0.9);
          opacity: 0.6;
        }
        50% {
          transform: scale(1.1);
          opacity: 0.9;
        }
      }

      .end-text-block {
        position: relative;
        margin-top: -40px;
        text-align: center;
        max-width: 320px;
      }

      .end-line1 {
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 4px;
      }

      .end-line2 {
        font-size: 0.95rem;
        opacity: 0.85;
      }

      .end-buttons {
        margin-top: 28px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: 100%;
        max-width: 360px;
      }

      .end-btn {
        border-radius: 999px;
        border: 1px solid rgba(156, 163, 175, 0.5);
        padding: 10px 18px;
        font-size: 0.9rem;
        font-weight: 500;
        text-align: center;
        text-decoration: none;
        color: #f9fafb;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        cursor: pointer;
        transition:
          transform 150ms ease,
          box-shadow 150ms ease,
          background 150ms ease,
          border-color 150ms ease,
          opacity 150ms ease;
      }

      .end-btn.primary {
        background: radial-gradient(
          circle at top left,
          rgba(236, 72, 153, 0.9),
          rgba(59, 130, 246, 0.9)
        );
        border-color: transparent;
        box-shadow: 0 0 32px rgba(236, 72, 153, 0.4);
      }

      .end-btn.ghost {
        background: rgba(15, 23, 42, 0.9);
      }

      .end-btn.outline {
        background: transparent;
        border-color: rgba(148, 163, 184, 0.7);
        opacity: 0.9;
      }

      .end-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 12px 40px rgba(15, 23, 42, 0.8);
      }

      .end-btn.primary:hover {
        box-shadow: 0 0 40px rgba(236, 72, 153, 0.7);
      }

      .end-btn span.label-sub {
        font-size: 0.8rem;
        opacity: 0.9;
      }

      .end-footer {
        margin-top: 24px;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 6px;
        opacity: 0;
        animation: footerIn 800ms ease forwards 800ms;
      }

      .end-heart {
        font-size: 0.9rem;
      }

      .end-counter {
        opacity: 0.85;
        animation: counterRoll 900ms ease-out forwards;
        transform: translateY(8px);
      }

      @keyframes footerIn {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes counterRoll {
        0% {
          transform: translateY(8px);
          opacity: 0;
        }
        60% {
          transform: translateY(-2px);
          opacity: 1;
        }
        100% {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @media (min-width: 768px) {
        .end-text-block {
          max-width: 420px;
        }
        .end-line1 {
          font-size: 1.25rem;
        }
        .end-line2 {
          font-size: 1rem;
        }
        .end-buttons {
          max-width: 420px;
        }
      }
    </style>
  </head>

  <body>
    <div id="yyovvo-container">
      <!-- BACKGROUND CINEMATIC (mood + skin combined) -->
      <video id="scene" playsinline autoplay muted></video>

      <!-- SELFIE VIDEO OVERLAY -->
      <video id="user-video" playsinline></video>

      <!-- INTRO TEXT OVERLAY -->
      <div id="overlay-intro" class="overlay-text"></div>

      <!-- MAIN MESSAGE TEXT OVERLAY (for text yyovvos) -->
      <div id="overlay-main-text" class="overlay-text"></div>

      <!-- OUTRO OVERLAY (yyovvo + tagline) -->
      <div id="overlay-outro" class="overlay-outro">
        <div class="outro-title">yyovvo</div>
        <div class="outro-sub">
          designed for emotion <span class="heart">‚ô°</span>
        </div>
      </div>

      <!-- OUTRO JINGLE -->
      <audio id="yyo-jingle" src="/audio/yyovvo-jingle.mp3"></audio>

      <!-- FINAL POST-YYOVVO END SCREEN -->
      <div id="end-screen" class="end-screen">
        <div class="end-pulse"></div>
        <div class="end-text-block">
          <div class="end-line1">This moment was made for you.</div>
          <div class="end-line2">by someone who cares about you.</div>
        </div>

        <div class="end-buttons">
          <!-- 1) Reply -->
          <a
            href="https://studio.yyovvo.com/CreateYyovvo"
            target="_blank"
            rel="noopener noreferrer"
            class="end-btn primary"
          >
            Reply with your own yyovvo
          </a>

          <!-- 2) Share -->
          <button type="button" id="share-btn" class="end-btn ghost">
            Share this moment on TikTok / Instagram
          </button>

          <!-- 3) Upgrade -->
          <a
            href="https://studio.yyovvo.com/upgrade"
            target="_blank"
            rel="noopener noreferrer"
            class="end-btn outline"
          >
            Unlock all yyovvo features
          </a>
        </div>

        <div class="end-footer">
          <span class="end-heart">‚ù§Ô∏è</span>
          <span class="end-counter" id="yyovvo-counter">
            2,777,777 yyovvos sent this season
          </span>
        </div>
      </div>
    </div>

    <!-- INLINE PLAYER: CINEMA + BASE44 + END SCREEN -->
    <script>
      (async function () {
        console.log("YYOVVO INLINE PLAYER v5 (Video in frame)");

        const scene = document.getElementById("scene");
        const userVideo = document.getElementById("user-video");
        const introEl = document.getElementById("overlay-intro");
        const mainEl = document.getElementById("overlay-main-text");
        const outroEl = document.getElementById("overlay-outro");
        const jingle = document.getElementById("yyo-jingle");
        const endScreen = document.getElementById("end-screen");
        const shareBtn = document.getElementById("share-btn");

        // TIMELINE (ms)
        const INTRO_START_MS = 3000;
        const INTRO_END_MS = 6000;
        const MAIN_START_MS = 6000;
        const OUTRO_START_MS = 14000;
        const END_SCREEN_START_MS = 18000;

        // 1) BACKGROUND mood+skin VIDEO
        const moodSkinUrl = "/videos/moodskin01.mp4";
        scene.src = moodSkinUrl;
        scene.loop = false;
        scene.muted = true;
        scene.playsInline = true;

        scene.play().catch((err) => {
          console.warn("Autoplay failed, waiting for user interaction.", err);
        });

        // DEFAULT TEXT + CONTENT
        let introText = "This moment was made for you.";
        let mainText = "Someone out there really cares about you.";
        let contentType = "text";
        let contentUrl = "";

        // 2) LOAD REAL DATA FROM BASE44
        try {
          const params = new URLSearchParams(window.location.search);
          const id = params.get("id");
          console.log("yyovvo id from URL:", id);

          if (id) {
            const url =
              "https://moment-cf83ed32.base44.app/api/apps/69023ddd9333e12fcf83ed32/functions/yyovvoGet?id=" +
              encodeURIComponent(id);

            console.log("Fetching yyovvo from:", url);
            const res = await fetch(url);
            console.log("Response status:", res.status);

            if (res.ok) {
              const raw = await res.json().catch(() => null);
              console.log("Raw yyovvo response:", raw);

              let data = raw;
              if (
                raw &&
                raw.data &&
                (raw.data.fields || raw.data.record)
              ) {
                data = raw.data.fields || raw.data.record;
              } else if (raw && raw.data) {
                data = raw.data;
              } else if (raw && raw.record) {
                data = raw.record;
              } else if (raw && raw.fields) {
                data = raw.fields;
              }

              console.log("Unwrapped yyovvo data:", data);

              if (data) {
                introText = data.intro_text || introText;
                mainText =
                  data.content_text ||
                  data.text_content ||
                  data.message ||
                  mainText;
                contentType = (data.content_type || "text").toLowerCase();
                contentUrl = data.content_url || "";

                console.log(
                  "PARSED:",
                  "contentType=",
                  contentType,
                  "contentUrl=",
                  contentUrl
                );
              }
            } else {
              console.warn(
                "yyovvoGet failed:",
                await res.text().catch(() => "")
              );
            }
          } else {
            console.warn("No ?id= in URL, using default emotional text.");
          }
        } catch (err) {
          console.warn("Error loading yyovvo:", err);
        }

        console.log("FINAL introText:", introText);
        console.log("FINAL mainText:", mainText);
        console.log("FINAL contentType:", contentType);
        console.log("FINAL contentUrl:", contentUrl);

        // 3) INTRO 3‚Äì6s
        setTimeout(() => {
          console.log("SHOW INTRO");
          introEl.textContent = introText;
          introEl.classList.add("show");
        }, INTRO_START_MS);

        setTimeout(() => {
          console.log("HIDE INTRO");
          introEl.classList.remove("show");
        }, INTRO_END_MS);

        // 4) MAIN (TEXT or VIDEO) from 6s
        setTimeout(() => {
          console.log("SHOW MAIN - contentType:", contentType);

          if (contentType === "video" && contentUrl) {
            console.log("PLAY USER VIDEO IN FRAME:", contentUrl);
            userVideo.src = contentUrl;
            userVideo.muted = false;
            userVideo.loop = false;
            userVideo.playsInline = true;
            userVideo.classList.add("show");
            userVideo
              .play()
              .catch((err) =>
                console.warn("User video autoplay failed:", err)
              );
          } else {
            console.log("SHOW MAIN TEXT:", mainText);
            mainEl.textContent = mainText;
            mainEl.classList.add("show");
          }
        }, MAIN_START_MS);

        // 5) OUTRO 14‚Äì18s
        setTimeout(() => {
          console.log("SHOW OUTRO + JINGLE");

          // hide any main overlays / video
          mainEl.classList.remove("show");
          userVideo.classList.remove("show");
          try {
            userVideo.pause();
          } catch (e) {}

          outroEl.classList.add("show");

          try {
            jingle.currentTime = 0;
            jingle.play().catch((err) => {
              console.warn("Jingle autoplay failed:", err);
            });
          } catch (e) {}
        }, OUTRO_START_MS);

        // 6) FINAL END SCREEN
        setTimeout(() => {
          console.log("SHOW END SCREEN");
          scene.pause();
          scene.style.opacity = "0";
          introEl.classList.remove("show");
          mainEl.classList.remove("show");
          outroEl.classList.remove("show");
          userVideo.classList.remove("show");
          endScreen.classList.add("show");
        }, END_SCREEN_START_MS);

        // 7) SHARE BUTTON
        if (shareBtn) {
          shareBtn.addEventListener("click", async () => {
            const shareUrl = window.location.href;
            const shareText =
              "Someone made this yyovvo moment just for me. üíå";

            if (navigator.share) {
              try {
                await navigator.share({
                  title: "yyovvo",
                  text: shareText,
                  url: shareUrl,
                });
              } catch (err) {
                console.warn("Native share cancelled/failed:", err);
              }
            } else {
              alert("Share this link:\n\n" + shareUrl);
            }
          });
        }
      })();
    </script>
  </body>
</html>
