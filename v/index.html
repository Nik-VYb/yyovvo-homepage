<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>yyovvo ‚Äî designed for emotion</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />

    <style>
      /* ROOT */
      html,
      body {
        margin: 0;
        padding: 0;
        background: #000;
        overflow: hidden;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", sans-serif;
        color: #f9fafb;
      }

      #yyovvo-container {
        position: fixed;
        inset: 0;
        background: #000;
        overflow: hidden;
      }

      /* BACKGROUND VIDEO LAYER (mood skin) */
      #bg-scene {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        background: #000;
        transition: opacity 400ms ease;
        filter: brightness(0.7) contrast(1.05) saturate(1.1);
        z-index: 1;
      }

      /* USER VIDEO FRAME - PREMIUM STYLING */
      #user-video-frame {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 85%;
        max-width: 380px;
        aspect-ratio: 9/16;
        border-radius: 24px;
        overflow: hidden;
        z-index: 2;
        opacity: 0;
        transition: opacity 600ms ease, transform 400ms ease;
        
        /* Premium frosted glass frame */
        background: rgba(15, 23, 42, 0.3);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        
        /* Glowing border */
        border: 2px solid rgba(255, 255, 255, 0.15);
        box-shadow: 
          0 0 0 1px rgba(236, 72, 153, 0.3),
          0 0 40px rgba(236, 72, 153, 0.4),
          0 0 80px rgba(56, 189, 248, 0.2),
          0 25px 50px rgba(0, 0, 0, 0.5),
          inset 0 0 30px rgba(255, 255, 255, 0.05);
      }

      #user-video-frame.show {
        opacity: 1;
      }

      #user-video-frame::before {
        content: "";
        position: absolute;
        inset: -2px;
        border-radius: 26px;
        background: linear-gradient(
          135deg,
          rgba(236, 72, 153, 0.5),
          rgba(56, 189, 248, 0.5),
          rgba(34, 197, 94, 0.3)
        );
        z-index: -1;
        opacity: 0.6;
        animation: borderGlow 3s ease-in-out infinite;
      }

      @keyframes borderGlow {
        0%, 100% { opacity: 0.4; }
        50% { opacity: 0.8; }
      }

      /* Vignette overlay on video */
      #user-video-frame::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 22px;
        background: radial-gradient(
          ellipse at center,
          transparent 50%,
          rgba(0, 0, 0, 0.4) 100%
        );
        pointer-events: none;
        z-index: 2;
      }

      #user-video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 22px;
        display: block;
      }

      /* LENS GLOW OVERLAY (STYLE A) */
      #lens-overlay {
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 3;
        background:
          radial-gradient(circle at 15% 0%, rgba(56, 189, 248, 0.28), transparent 55%),
          radial-gradient(circle at 85% 10%, rgba(236, 72, 153, 0.3), transparent 55%),
          radial-gradient(circle at 50% 100%, rgba(34, 197, 94, 0.18), transparent 60%),
          radial-gradient(circle at 50% 50%, rgba(15, 23, 42, 0.8), transparent 80%);
        mix-blend-mode: screen;
        opacity: 0.9;
      }

      /* Faux film grain */
      #lens-overlay::after {
        content: "";
        position: absolute;
        inset: 0;
        opacity: 0.14;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 160 160' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.2' numOctaves='3' stitchTiles='noStitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.6'/%3E%3C/svg%3E");
        mix-blend-mode: soft-light;
      }

      /* TEXT OVERLAYS */
      .overlay-text {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 18px;
        text-align: center;
        font-size: 1.1rem;
        line-height: 1.6;
        color: #f9fafb;
        text-shadow:
          0 0 18px rgba(0, 0, 0, 0.9),
          0 0 30px rgba(0, 0, 0, 0.9);
        opacity: 0;
        z-index: 4;
        transition: opacity 320ms ease;
      }

      .overlay-text.show {
        opacity: 1;
      }

      /* OUTRO (yyovvo + tagline) */
      .overlay-outro {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 6px;
        text-align: center;
        color: #f9fafb;
        text-shadow:
          0 0 18px rgba(0, 0, 0, 0.95),
          0 0 30px rgba(0, 0, 0, 0.95);
        opacity: 0;
        z-index: 5;
        transition: opacity 400ms ease;
      }

      .overlay-outro.show {
        opacity: 1;
      }

      .outro-title {
        font-size: 2.2rem;
        letter-spacing: 0.18em;
        text-transform: lowercase;
      }

      .outro-sub {
        font-size: 0.95rem;
        opacity: 0.9;
      }

      .heart {
        display: inline-block;
        animation: pulse 1.2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 0.8; }
        50% { transform: scale(1.16); opacity: 1; }
      }

      /* TAP TO UNMUTE */
      #tap-to-unmute {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 999px;
        padding: 12px 24px;
        font-size: 14px;
        color: #fff;
        cursor: pointer;
        z-index: 100;
        opacity: 0;
        transition: opacity 300ms ease;
        display: none;
      }

      #tap-to-unmute.show {
        display: block;
        opacity: 1;
      }

      /* FINAL END SCREEN */
      .end-screen {
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at center, #020617, #000);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 26px 22px 34px;
        opacity: 0;
        pointer-events: none;
        z-index: 10;
        transition: opacity 500ms ease;
      }

      .end-screen.show {
        opacity: 1;
        pointer-events: auto;
      }

      .end-pulse {
        width: 170px;
        height: 170px;
        border-radius: 999px;
        background: radial-gradient(
          circle at center,
          rgba(236, 72, 153, 0.45),
          transparent 70%
        );
        opacity: 0.75;
        filter: blur(14px);
        animation: endPulseGlow 2.4s ease-in-out infinite;
        pointer-events: none;
      }

      @keyframes endPulseGlow {
        0%, 100% { transform: scale(0.9); opacity: 0.7; }
        50% { transform: scale(1.08); opacity: 0.95; }
      }

      .end-text-block {
        position: relative;
        margin-top: -44px;
        text-align: center;
        max-width: 330px;
      }

      .end-line1 {
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 4px;
      }

      .end-line2 {
        font-size: 0.95rem;
        opacity: 0.86;
      }

      .end-buttons {
        margin-top: 26px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: 100%;
        max-width: 360px;
      }

      .end-btn {
        border-radius: 999px;
        border: 1px solid rgba(156, 163, 175, 0.55);
        padding: 10px 18px;
        font-size: 0.9rem;
        font-weight: 500;
        text-align: center;
        text-decoration: none;
        color: #f9fafb;
        background: rgba(15, 23, 42, 0.9);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        cursor: pointer;
        transition: transform 150ms ease, box-shadow 150ms ease;
      }

      .end-btn.primary {
        background: radial-gradient(
          circle at top left,
          rgba(236, 72, 153, 0.95),
          rgba(59, 130, 246, 0.95)
        );
        border-color: transparent;
        box-shadow: 0 0 32px rgba(236, 72, 153, 0.5);
      }

      .end-btn.ghost {
        background: rgba(15, 23, 42, 0.92);
      }

      .end-btn.outline {
        background: transparent;
        border-color: rgba(148, 163, 184, 0.8);
        opacity: 0.9;
      }

      .end-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 40px rgba(15, 23, 42, 0.9);
      }

      .end-btn.primary:hover {
        box-shadow: 0 0 40px rgba(236, 72, 153, 0.8);
      }

      .end-footer {
        margin-top: 22px;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 6px;
        opacity: 0;
        animation: footerIn 800ms ease forwards 900ms;
      }

      .end-heart {
        font-size: 0.9rem;
      }

      @keyframes footerIn {
        from { opacity: 0; transform: translateY(6px); }
        to { opacity: 1; transform: translateY(0); }
      }

      @media (min-width: 768px) {
        #user-video-frame {
          max-width: 420px;
        }
        .end-text-block {
          max-width: 420px;
        }
        .end-line1 {
          font-size: 1.25rem;
        }
        .end-line2 {
          font-size: 1rem;
        }
        .end-buttons {
          max-width: 420px;
        }
      }

      @media (max-width: 640px) {
        #user-video-frame {
          width: 90%;
          max-width: 320px;
        }
        .overlay-outro {
          padding: 0 1.5rem;
        }
        .overlay-outro .outro-title {
          font-size: 24px;
          letter-spacing: 0.16em;
        }
        .overlay-outro .outro-sub {
          font-size: 12px;
          margin-top: 6px;
        }
      }
    </style>
  </head>

  <body>
    <div id="yyovvo-container">
      <!-- BACKGROUND VIDEO (mood skin / outro snow) -->
      <video id="bg-scene" playsinline autoplay muted loop></video>

      <!-- USER VIDEO IN PREMIUM FRAME -->
      <div id="user-video-frame">
        <video id="user-video" playsinline></video>
      </div>

      <!-- LENS GLOW OVERLAY -->
      <div id="lens-overlay"></div>

      <!-- INTRO TEXT OVERLAY -->
      <div id="overlay-intro" class="overlay-text"></div>

      <!-- MAIN MESSAGE TEXT OVERLAY (for text-mode yyovvos) -->
      <div id="overlay-main-text" class="overlay-text"></div>

      <!-- OUTRO OVERLAY (yyovvo + tagline) -->
      <div id="overlay-outro" class="overlay-outro">
        <div class="outro-title">yyovvo</div>
        <div class="outro-sub">
          designed for emotion <span class="heart">‚ô°</span>
        </div>
      </div>

      <!-- TAP TO UNMUTE -->
      <button id="tap-to-unmute">üîä Tap to unmute</button>

      <!-- OUTRO JINGLE -->
      <audio id="yyo-jingle" src="/audio/yyovvo-jingle.mp3"></audio>

      <!-- FINAL POST-YYOVVO END SCREEN -->
      <div id="end-screen" class="end-screen">
        <div class="end-pulse"></div>
        <div class="end-text-block">
          <div class="end-line1">this moment was made for you.</div>
          <div class="end-line2">by someone who really cares about you.</div>
        </div>

        <div class="end-buttons">
          <a
            href__="https://studio.yyovvo.com/CreateYyovvo"
            target="_blank"
            rel="noopener noreferrer"
            class="end-btn primary"
          >
            reply with your own yyovvo
          </a>

          <button type="button" id="share-btn" class="end-btn ghost">
            share this moment on tiktok / instagram
          </button>

          <a
            href__="https://studio.yyovvo.com/upgrade"
            target="_blank"
            rel="noopener noreferrer"
            class="end-btn outline"
          >
            unlock all yyovvo features
          </a>
        </div>

        <div class="end-footer">
          <span class="end-heart">‚ù§Ô∏è</span>
          <span id="yyovvo-counter">2,777,777 yyovvos sent this season</span>
        </div>
      </div>
    </div>

    <script>
      (async function () {
        console.log("yyovvo cinematic player v2 ‚Äî premium frame + video-ended trigger");

        const bgScene = document.getElementById("bg-scene");
        const userVideoFrame = document.getElementById("user-video-frame");
        const userVideo = document.getElementById("user-video");
        const introEl = document.getElementById("overlay-intro");
        const mainEl = document.getElementById("overlay-main-text");
        const outroEl = document.getElementById("overlay-outro");
        const jingle = document.getElementById("yyo-jingle");
        const endScreen = document.getElementById("end-screen");
        const shareBtn = document.getElementById("share-btn");
        const tapToUnmute = document.getElementById("tap-to-unmute");

        // TIMELINE
        const INTRO_START_MS = 2500;
        const INTRO_END_MS = 5500;
        const MAIN_START_MS = 6000;
        const OUTRO_DURATION_MS = 4000;

        // State
        let contentType = "text";
        let contentUrl = "";
        let introText = "this moment was made for you.";
        let mainText = "someone out there really cares about you.";
        let hasUserInteracted = false;

        // 1) Start mood skin background
        bgScene.src = "/videos/moodskin01.mp4";
        bgScene.loop = true;
        bgScene.muted = true;
        bgScene.play().catch(() => {});

        // 2) Load data from Base44
        try {
          const params = new URLSearchParams(window.location.search);
          const id = params.get("id");

          if (id) {
            const url = `https://moment-cf83ed32.base44.app/api/apps/69023ddd9333e12fcf83ed32/functions/yyovvoGet?id=${encodeURIComponent(id)}`;
            const res = await fetch(url);

            if (res.ok) {
              const data = await res.json();
              console.log("yyovvo data:", data);

              introText = data.intro_text || introText;
              mainText = data.content_text || mainText;
              contentType = (data.content_type || "text").toLowerCase();
              contentUrl = data.content_url || "";

              console.log("contentType:", contentType, "contentUrl:", contentUrl);
            }
          }
        } catch (err) {
          console.warn("Error loading yyovvo:", err);
        }

        // 3) Handle unmute on tap
        function enableAudio() {
          if (hasUserInteracted) return;
          hasUserInteracted = true;
          tapToUnmute.classList.remove("show");
          
          if (contentType === "video" && userVideo.src) {
            userVideo.muted = false;
          }
        }

        tapToUnmute.addEventListener("click", enableAudio);
        document.addEventListener("click", enableAudio, { once: true });
        document.addEventListener("touchstart", enableAudio, { once: true });

        // 4) Show intro text
        setTimeout(() => {
          introEl.textContent = introText;
          introEl.classList.add("show");
        }, INTRO_START_MS);

        setTimeout(() => {
          introEl.classList.remove("show");
        }, INTRO_END_MS);

        // 5) Main content start
        setTimeout(() => {
          if (contentType === "video" && contentUrl) {
            console.log("Playing user video:", contentUrl);
            
            // Show the premium frame
            userVideoFrame.classList.add("show");
            
            // Load and play video
            userVideo.src = contentUrl;
            userVideo.muted = !hasUserInteracted; // Mute only if no interaction yet
            userVideo.playsInline = true;
            
            userVideo.play().then(() => {
              if (!hasUserInteracted) {
                tapToUnmute.classList.add("show");
              }
            }).catch(err => {
              console.warn("Video autoplay failed:", err);
              tapToUnmute.classList.add("show");
            });

            // Wait for video to END before showing outro
            userVideo.addEventListener("ended", () => {
              console.log("User video ended, triggering outro");
              triggerOutro();
            }, { once: true });

          } else {
            // TEXT MODE
            mainEl.textContent = mainText;
            mainEl.classList.add("show");

            // For text, use a fixed duration
            setTimeout(() => {
              mainEl.classList.remove("show");
              triggerOutro();
            }, 6000);
          }
        }, MAIN_START_MS);

        // 6) Outro function
        function triggerOutro() {
          console.log("OUTRO START");

          // Hide video frame
          userVideoFrame.classList.remove("show");

          // Switch background to outro snow
          bgScene.src = "/videos/outro-snow.mp4";
          bgScene.loop = true;
          bgScene.play().catch(() => {});

          // Show outro overlay
          outroEl.classList.add("show");

          // Play jingle
          try {
            jingle.currentTime = 0;
            jingle.play().catch(() => {});
          } catch (e) {}

          // After outro duration, show end screen
          setTimeout(() => {
            console.log("END SCREEN");
            bgScene.pause();
            bgScene.style.opacity = "0.3";
            outroEl.classList.remove("show");
            endScreen.classList.add("show");
          }, OUTRO_DURATION_MS);
        }

        // 7) Share button
        if (shareBtn) {
          shareBtn.addEventListener("click", async () => {
            const shareUrl = window.location.href;
            const shareText = "Someone made this yyovvo moment just for me. üíå";

            if (navigator.share) {
              try {
                await navigator.share({
                  title: "yyovvo ‚Äî designed for emotion",
                  text: shareText,
                  url: shareUrl,
                });
              } catch (err) {}
            } else {
              navigator.clipboard.writeText(shareUrl);
              alert("Link copied!");
            }
          });
        }
      })();
    </script>
  </body>
</html>
